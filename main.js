(()=>{"use strict";var e={inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disable",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"},t=document.querySelector(".popup_type_edit"),r=t.querySelector("#userName-input"),n=t.querySelector("#userInfo-input"),o=document.querySelector(".profile__edit-button"),i=t.querySelector(".popup__submit"),u=document.querySelector(".profile__add-button"),a=document.querySelector(".popup_type_add").querySelector(".popup__submit"),s=document.querySelector(".profile__avatar"),c=document.querySelector(".popup_type_edit-avatar").querySelector(".popup__submit"),l=document.querySelector(".popup_type_confirmation").querySelector(".popup__submit");function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function e(t,r){var n=t.cardData,o=t.handleCardClick,i=t.handleLikeClick,u=t.handledeleteCard,a=t.setEventListeners,s=t.userId;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cardData=n,this._cardTemplate=r,this._handleCardClick=o,this._handleLikeClick=i,this._handledeleteCard=u,this._setEventListeners=a,this._userId=s}var t,r;return t=e,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardTemplate).content.querySelector(".card").cloneNode(!0)}},{key:"createCard",value:function(){var e=this;this._element=this._getTemplate();var t=this._element.querySelector(".card__image"),r=this._element.querySelector(".card__like-number"),n=this._element.querySelector(".card__title");return this._cardData.owner&&this._cardData.owner._id!==this._userId&&this._element.querySelector(".card__delete").remove(),this._cardData.likes.forEach((function(t){t._id===e._userId&&e._element.querySelector(".card__like").classList.add("card__like_active")})),t.src=this._cardData.link,t.alt=this._cardData.name,r.textContent=this._cardData.likes.length,n.textContent=this._cardData.name,this._setEventListeners(this._element),this._element}}])&&f(t.prototype,r),e}();function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formsData=t,this._formElement=r,this._openButton=n,this._form=document.querySelector(this._formElement),this._inputs=Array.from(this._form.querySelectorAll(this._formsData.inputSelector)),this._submit=this._form.querySelector(this._formsData.submitButtonSelector),this._errorClass=this._formsData.errorClass,this._inputErrorClass=this._formsData.inputErrorClass,this._buttonDisabledClass=this._formsData.inactiveButtonClass}var t,r;return t=e,(r=[{key:"_showInputError",value:function(){this._formError.classList.add(this._errorClass),this._formError.textContent=this._input.validationMessage,this._input.classList.add(this._inputErrorClass)}},{key:"_hideInputError",value:function(){this._formError&&(this._formError.classList.remove(this._errorClass),this._input.classList.remove(this._inputErrorClass))}},{key:"addSubmitDisabled",value:function(){this._submit.classList.add(this._buttonDisabledClass),this._submit.setAttribute("disabled","disabled")}},{key:"_addSubmitActive",value:function(){this._submit.classList.remove(this._buttonDisabledClass),this._submit.removeAttribute("disabled")}},{key:"_isValid",value:function(e){this._input=e,this._formError=this._form.querySelector(".".concat(this._input.id,"-error")),this._input.validity.valid?this._hideInputError():this._showInputError()}},{key:"_hasInvalidInput",value:function(){return this._inputs.some((function(e){return!e.validity.valid}))}},{key:"_toggleSubmit",value:function(){this._hasInvalidInput()?this.addSubmitDisabled():this._addSubmitActive()}},{key:"enableValidation",value:function(){var e=this;this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._form.addEventListener("input",(function(t){e._isValid(t.target),e._toggleSubmit()})),this._openButton.addEventListener("click",(function(t){e._hideInputError()}))}}])&&d(t.prototype,r),e}();function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=function(){function e(t,r){var n=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initialArray=n,this._renderer=o,this._container=document.querySelector(r)}var t,r;return t=e,(r=[{key:"addItem",value:function(e,t){"append"===t?this._container.append(e):"prepend"===t&&this._container.prepend(e)}},{key:"renderItems",value:function(){var e=this;this._initialArray.forEach((function(t){e._renderer(t)}))}}])&&_(t.prototype,r),e}();function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this.escClose=this._handleEscClose.bind(this)}var t,r;return t=e,(r=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this.escClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this.escClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-button"))&&e.close()}))}}])&&m(t.prototype,r),e}();function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function S(e,t,r){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(u,e);var t,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=C(n);if(o){var r=C(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return w(this,e)});function u(e){var t,r=e.popupSelector,n=e.handleFormSubmit;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,r))._handleFormSubmit=n,t._popupForm=t._popup.querySelector("form"),t}return t=u,(r=[{key:"setEventListeners",value:function(){var e=this;S(C(u.prototype),"setEventListeners",this).call(this),this._popupForm.addEventListener("submit",(function(t){t.preventDefault(),e._handleFormSubmit(e._getInputValues())}))}},{key:"_getInputValues",value:function(){var e=this;return this._inputList=this._popup.querySelectorAll("input"),this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"close",value:function(){S(C(u.prototype),"close",this).call(this),this._popupForm.reset()}}])&&k(t.prototype,r),u}(v);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e,t,r){return(q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(u,e);var t,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(n);if(o){var r=D(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return I(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._previewImg=t._popup.querySelector(".popup__image"),t._previewTittle=t._popup.querySelector(".popup__title"),t}return t=u,(r=[{key:"open",value:function(e){q(D(u.prototype),"open",this).call(this);var t=e.target.closest(".card").querySelector(".card__title");this._previewImg.src=e.target.src,this._previewImg.alt=e.target.alt,this._previewTittle.textContent=t.textContent}}])&&L(t.prototype,r),u}(v);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function x(e,t,r){return(x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=A(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(u,e);var t,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=A(n);if(o){var r=A(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return N(this,e)});function u(e){var t,r=e.popupSelector,n=e.handleFormSubmit;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,r))._handleFormSubmit=n,t._popupForm=t._popup.querySelector("form"),t}return t=u,(r=[{key:"setEventListeners",value:function(){var e=this;x(A(u.prototype),"setEventListeners",this).call(this),this._popupForm.addEventListener("submit",(function(t){t.preventDefault(),e._handleFormSubmit(e.getCardData())}))}},{key:"setCardData",value:function(e,t){this._cardData={},this._cardData.cardId=e,this._cardData.elem=t}},{key:"getCardData",value:function(){return this._cardData}}])&&T(t.prototype,r),u}(v);function U(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var V=function(){function e(t){var r=t.userNameSelector,n=t.userInfoSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userName=document.querySelector(r),this._userInfo=document.querySelector(n)}var t,r;return t=e,(r=[{key:"getUserInfo",value:function(){return{userName:this._userName.textContent,userInfo:this._userInfo.textContent}}},{key:"setUserInfo",value:function(e,t){e&&(this._userName.textContent=e),t&&(this._userInfo.textContent=t)}}])&&U(t.prototype,r),e}();function M(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var J=new(function(){function e(t){var r=t.baseUrl,n=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseUrl=r,this.headers=n,this.urlCards=this.baseUrl+"/cards",this.urlOwnerMe=this.baseUrl+"/users/me"}var t,r;return t=e,(r=[{key:"_checkResults",value:function(e){return e.then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"getInitialCards",value:function(){return this._checkResults(fetch(this.urlCards,{headers:this.headers}))}},{key:"getOwner",value:function(){return this._checkResults(fetch(this.urlOwnerMe,{headers:this.headers}))}},{key:"editNameRequest",value:function(e,t){return this._checkResults(fetch(this.urlOwnerMe,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}))}},{key:"addCardRequest",value:function(e,t){return this._checkResults(fetch(this.urlCards,{method:"POST",headers:this.headers,body:JSON.stringify({name:e,link:t})}))}},{key:"deleteCardRequest",value:function(e){return this._checkResults(fetch(this.urlCards+"/"+e,{method:"DELETE",headers:this.headers}))}},{key:"putLikeRequest",value:function(e){return this._checkResults(fetch(this.urlCards+"/likes/"+e,{method:"PUT",headers:this.headers}))}},{key:"deleteLikeRequest",value:function(e){return this._checkResults(fetch(this.urlCards+"/likes/"+e,{method:"DELETE",headers:this.headers}))}},{key:"editAvatarRequest",value:function(e){return this._checkResults(fetch(this.urlOwnerMe+"/avatar",{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}))}}])&&M(t.prototype,r),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-26",headers:{authorization:"f4a0975c-9f5e-42b4-a1a3-2878883687ab","Content-Type":"application/json"}});J.getOwner().then((function(t){function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Cохранить";t.textContent=e?"Сохранение...":r}function d(e){return new p({cardData:e,handleCardClick:function(e){return S.open(e)},userId:t._id,handleLikeClick:function(t,r){t.target.classList.contains("card__like_active")?J.deleteLikeRequest(e._id).then((function(e){t.target.classList.remove("card__like_active"),r.querySelector(".card__like-number").textContent=e.likes.length})).catch((function(e){return console.log(e)})):J.putLikeRequest(e._id).then((function(e){t.target.classList.add("card__like_active"),r.querySelector(".card__like-number").textContent=e.likes.length})).catch((function(e){return console.log(e)}))},handledeleteCard:function(t){O.setCardData(e._id,t),O.open()},setEventListeners:function(e){var t=this;e.querySelector(".card__like").addEventListener("click",(function(r){return t._handleLikeClick(r,e)})),e.querySelector(".card__delete")&&e.querySelector(".card__delete").addEventListener("click",(function(){return t._handledeleteCard(e)})),e.querySelector(".card__image").addEventListener("click",(function(e){return t._handleCardClick(e)}))}},"#cardTemp").createCard()}var _,m=new V({userNameSelector:".profile__title",userInfoSelector:".profile__subtitle"}),v=new h(e,'.popup__form[name="popupEditForm"]',o),b=new h(e,'.popup__form[name="popupAddForm"]',u),k=new h(e,'.popup__form[name="popupEditAvatarForm"]',s),S=new j(".popup_type_preview"),g=new E({popupSelector:".popup_type_add",handleFormSubmit:function(e){f(!0,a),J.addCardRequest(e.name,e.link).then((function(e){_.addItem(d(e),"prepend"),g.close(),b.addSubmitDisabled()})).catch((function(e){return console.log(e)})).finally((function(){return f(!1,a,"Создать")}))}}),w=new E({popupSelector:".popup_type_edit",handleFormSubmit:function(e){f(!0,i),m.setUserInfo(e.userName,e.userInfo),J.editNameRequest(e.userName,e.userInfo).then((function(e){w.close(),v.addSubmitDisabled()})).catch((function(e){return console.log(e)})).finally((function(){return f(!1,i,"Сохранить")}))}}),C=new E({popupSelector:".popup_type_edit-avatar",handleFormSubmit:function(e){f(!0,c),J.editAvatarRequest(e.link).then((function(e){s.style.backgroundImage="url('".concat(e.avatar,"')"),C.close(),k.addSubmitDisabled()})).catch((function(e){return console.log(e)})).finally((function(){return f(!1,c,"Сохранить")}))}}),O=new B({popupSelector:".popup_type_confirmation",handleFormSubmit:function(e){f(!0,l),J.deleteCardRequest(e.cardId).then((function(t){O.close(),e.elem.remove()})).catch((function(e){return console.log(e)})).finally((function(){return f(!1,l,"Да")}))}});J.getInitialCards().then((function(e){(_=new y({items:e,renderer:function(e){_.addItem(d(e),"append")}},".cards")).renderItems()})),m.setUserInfo(t.name,t.about),s.style.backgroundImage="url('".concat(t.avatar,"')"),k.enableValidation(),b.enableValidation(),v.enableValidation(),S.setEventListeners(),C.setEventListeners(),O.setEventListeners(),g.setEventListeners(),w.setEventListeners(),u.addEventListener("click",(function(){g.open()})),s.addEventListener("click",(function(){C.open()})),o.addEventListener("click",(function(){w.open();var e=m.getUserInfo();r.value=e.userName,n.value=e.userInfo}))})).catch((function(e){return console.log(e)}))})();